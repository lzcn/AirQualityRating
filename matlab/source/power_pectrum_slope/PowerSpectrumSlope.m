% compute the power spectrum slope of image patch
% patch size 17*17
function alpha = PowerSpectrumSlope(patch)
imf = fftshift(fft2(patch));    
% power spectrum:S(u,v)
impf = imf.*conj(imf)/numel(imf);
if 1
% if size(patch,1) > 17
    Pf = rotavg(impf);
else
% rotational average of the power spectrum 
    idx{1} = [127,128,129,144,146,161,162,163];
    idx{2} = [110,111,112,126,130,143,147,160,164,178,179,180];
    idx{3} = [93,94,95,109,113,125,131,142,148,159,165,177,181,195,196,197];
    idx{4} = [75,76,77,78,79,91,92,96,97,107,108,114,115,124,132,141,149,158,166,175,176,182,183,193,194,198,199,211,212,213,214,215];
    idx{5} = [58,59,60,61,62,74,80,90,98,106,116,123,133,140,150,157,167,174,184,192,200,210,216,228,229,230,231,232];
    idx{6} = [41,42,43,44,45,56,57,63,64,72,73,81,82,89,99,105,117,122,134,139,151,156,168,173,185,191,201,208,209,217,218,226,227,233,234,245,246,247,248,249];
    idx{7} = [24,25,26,27,28,39,40,46,47,55,65,71,83,88,100,104,118,121,135,138,152,155,169,172,186,190,202,207,219,225,235,243,244,250,251,262,263,264,265,266];
    idx{8} = [7,8,9,10,11,22,23,29,30,37,38,48,49,54,66,70,84,87,101,103,119,120,136,137,153,154,170,171,187,189,203,206,220,224,236,241,242,252,253,260,261,267,268,279,280,281,282,283];
    idx{9} = [4,5,6,12,13,14,20,21,31,32,36,50,52,53,67,68,69,85,86,102,188,204,205,221,222,223,237,238,240,254,258,259,269,270,276,277,278,284,285,286];
    idx{10} = [3,15,19,33,35,51,239,255,257,271,275,287];
    idx{11} = [1,2,16,17,18,34,256,272,273,274,288,289];
    L = 11;
    Pf = zeros(L,1);
    for r = 1:L
        Pf(r)= mean(impf(idx{r}));
    end 
end
X = log(1:size(Pf,1))';
Y = log(Pf);
temp = polyfit(X, Y, 1); 
alpha = - temp(1);